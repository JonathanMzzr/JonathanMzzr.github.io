<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>STITCH ‚Äì Votre assistant IA personnel</title>
<style>
:root{
  --bg          : #f9fafb;
  --bg-alt      : #ffffff;
  --fg          : #111827;
  --fg-alt      : #374151;
  --accent      : #6366f1;
  --bubble-user : #dbeafe;
  --bubble-bot  : #e0e7ff;
}
.dark{
  --bg          : #0f172a;
  --bg-alt      : #1e293b;
  --fg          : #f8fafc;
  --fg-alt      : #cbd5e1;
  --accent      : #818cf8;
  --bubble-user : #1e40af;
  --bubble-bot  : #334155;
}

*{box-sizing:border-box;font-family:system-ui,Segoe UI,Inter,sans-serif;}
body{margin:0;height:100vh;background:var(--bg);color:var(--fg);display:flex;flex-direction:column;}
header{padding:8px 16px;background:var(--bg-alt);display:flex;align-items:center;gap:12px;border-bottom:1px solid var(--fg-alt);}
header h1{font-size:1rem;margin:0;flex:1;}
header select{padding:4px;border-radius:4px;background:var(--bg);color:var(--fg);border:1px solid var(--fg-alt);}
#log{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;}
.bubble{max-width:70%;padding:10px 14px;border-radius:12px;white-space:pre-wrap;line-height:1.4;}
.me   {align-self:flex-end;background:var(--bubble-user);}
.bot  {align-self:flex-start;background:var(--bubble-bot);}
form{display:flex;gap:8px;padding:12px 16px;border-top:1px solid var(--fg-alt);background:var(--bg-alt);}
form input{flex:1;padding:10px;border-radius:6px;border:1px solid var(--fg-alt);background:var(--bg);color:var(--fg);}
form button{padding:0 18px;border:none;border-radius:6px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer;}
.toast{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:#dc2626;color:#fff;padding:8px 16px;border-radius:6px;display:none;}
</style>
</head>
<body>
  <header>
    <h1>STITCH ‚Äì Votre assistant IA personnel</h1>
    <label for="theme">Th√®me :</label>
    <select id="theme">
      <option value="">Clair</option>
      <option value="dark">Sombre</option>
    </select>
  </header>

  <main id="log"></main>

  <form id="sendForm">
    <input id="prompt" autocomplete="off" placeholder="√âcris ta question ‚Ä¶" />
    <button type="submit">Send ‚èé</button>
  </form>

  <div id="toast" class="toast">Erreur serveur&nbsp;üò¢</div>

<script>
const log      = document.getElementById('log');
const promptEl = document.getElementById('prompt');
const form     = document.getElementById('sendForm');
const toast    = document.getElementById('toast');
const themeSel = document.getElementById('theme');

// == Utils ==
function addMsg(text, cls){
  const b = document.createElement('div');
  b.className = 'bubble '+cls;
  b.textContent = text;
  log.appendChild(b);
  log.scrollTop = log.scrollHeight;
}
function showToast(msg){
  toast.textContent = msg;
  toast.style.display = 'block';
  setTimeout(()=>toast.style.display='none', 3000);
}

// == Theme persistant ==
themeSel.value = localStorage.getItem('stitch-theme') || '';
document.documentElement.className = themeSel.value;
themeSel.onchange = e=>{
  localStorage.setItem('stitch-theme', e.target.value);
  document.documentElement.className = e.target.value;
};

/* ===== ENVOI DU MESSAGE AU BACKEND ===== */
form.onsubmit = async e=>{
  e.preventDefault();
  const q = promptEl.value.trim();
  if(!q) return;
  promptEl.value='';
  addMsg(q,'me');

  try{
    
    const res = await fetch('/v1/chat/completions',{
      method : 'POST',
      headers: {'Content-Type':'application/json'},
      body   : JSON.stringify({ prompt: q })
    });
    if(!res.ok) throw new Error(res.statusText);
    const data = await res.json();
    addMsg(data.response || '[R√©ponse vide]', 'bot');
  }catch(err){
    showToast('Backend indisponible');
    console.error(err);
  }
};

/* Ctrl + Enter pour envoyer */
promptEl.addEventListener('keydown',e=>{
  if(e.key==='Enter' && e.ctrlKey) form.requestSubmit();
});
</script>
</body>
</html>
